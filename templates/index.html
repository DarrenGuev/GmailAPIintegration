{% extends "base.html" %} {% block Head %}
<title>EZ Mail - Student Mailer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='popup.css') }}">
<link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Judson&display=swap" rel="stylesheet" />
{% endblock %} {% block Body %}
<div class="v6_2">
  <div class="v58_20"></div>
  <div class="v8_12">
    <span class="v8_13">EZ mail</span>
    <!-- Inbox and Profile Container -->
    <div class="top-right-nav">
      <div class="home-container">
        <div class="home-nav" onclick="toggleHomeDropdown()">
          Home
        </div>
        <div class="dropdown-menu" id="homeDropdown">
          <a href="/inbox" class="dropdown-item">Inbox</a>
        </div>
      </div>
      <div class="profile-container">
        <div class="profile-icon" onclick="toggleDropdown()">
          {% if session.user_picture %}
          <img src="{{ session.user_picture }}" alt="avatar" class="avatar-img" />
          {% else %}
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" fill="currentColor" />
            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" />
          </svg>
          {% endif %}
        </div>
        <div class="dropdown-menu" id="profileDropdown">
          <div class="dropdown-header">
            <div class="user-avatar">
              {% if session.user_picture %}
              <img src="{{ session.user_picture }}" alt="avatar" class="avatar-img small" />
              {% else %}
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="8" r="4" fill="currentColor" />
                <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" />
              </svg>
              {% endif %}
            </div>
            <div class="user-info">
              <div class="user-email">{{ session.user_email }}</div>
            </div>
          </div>  
          <div class="dropdown-divider"></div>
          <a href="/logout" class="dropdown-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" />
              <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            Logout
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Card Container -->
  <div class="container d-flex justify-content-center align-items-center" style="min-height: 70vh; padding-top: 50px">
    <div class="card shadow-lg" style="
        width: 100%;
        max-width: 600px;
        border-radius: 25px;
        background: rgba(236, 213, 187, 1);
        border: none;
      ">
      <div class="card-body p-5">
        <h2 class="card-title text-center mb-4" style="
            color: rgba(113, 1, 23, 1);
            font-family: Judson;
            font-weight: bold;
            font-size: 2.5rem;
          ">
          Student Mailer
        </h2>

        <form id="sendForm" action="/send" method="post">
          <div class="mb-4">
            <label for="subject" class="form-label" style="
                color: rgba(77, 70, 70, 1);
                font-family: Judson;
                font-weight: 500;
                font-size: 1.1rem;
              ">Subject:</label>
            <input type="text" class="form-control form-control-lg" id="subject" name="subject"
              placeholder="Enter subject" required style="
                border-radius: 10px;
                border: 2px solid rgba(156, 142, 129, 1);
                font-family: Judson;
              " />
          </div>

          <div class="mb-4">
            <label for="recipient" class="form-label" style="
                color: rgba(77, 70, 70, 1);
                font-family: Judson;
                font-weight: 500;
                font-size: 1.1rem;
              ">Recipient:</label>
            <input type="email" class="form-control form-control-lg" id="recipient" name="to"
              placeholder="Enter recipient email" required style="
                border-radius: 10px;
                border: 2px solid rgba(156, 142, 129, 1);
                font-family: Judson;
              " />
          </div>

          <div class="mb-4">
            <label for="message" class="form-label" style="
                color: rgba(77, 70, 70, 1);
                font-family: Judson;
                font-weight: 500;
                font-size: 1.1rem;
              ">Message:</label>
            <textarea class="form-control" id="message" name="message" rows="5" placeholder="Enter your message"
              required style="
                border-radius: 10px;
                border: 2px solid rgba(156, 142, 129, 1);
                font-family: Judson;
                resize: vertical;
              "></textarea>
          </div>

          <div class="d-grid gap-3 d-md-flex justify-content-md-center">
            <button type="submit" class="btn btn-lg px-4" style="
                background-color: rgba(84, 98, 123, 1);
                border: none;
                border-radius: 13px;
                color: white;
                font-family: Judson;
                font-weight: bold;
                font-size: 1.2rem;
              ">
              SEND
            </button>
            <a href="{{ url_for('index') }}" class="btn btn-lg px-4" style="
                background-color: rgba(123, 109, 84, 1);
                border: none;
                border-radius: 13px;
                color: white;
                font-family: Judson;
                font-weight: bold;
                font-size: 1.2rem;
              ">
              DELETE
            </a>

          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal (hidden by default) -->
<div id="successModal" class="modal" style="display:none;">
  <div class="modal-content shadow-lg">
    <button class="close-btn" onclick="closeModal()" aria-label="Close">&times;</button>
    <h1 class="mb-3" style="font-family: Judson; font-weight: bold;">Email sent successfully!âœ… </h1>
    <p class="mb-4" style="font-family: Judson;">Your message was sent to: <b id="successEmail"></b></p>
    <div class="d-grid gap-2">
      <a href="/inbox" class="btn mb-2" style="background-color: #54627B; color: white; border-radius: 13px; font-family: Judson; font-weight: bold;">
        ðŸ“¥ View Inbox
      </a>
      <a href="/" class="btn" style="background-color: #7B6D54; color: white; border-radius: 13px; font-family: Judson; font-weight: bold;">
        âœ‰ Send Another Email
      </a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function toggleHomeDropdown() {
    document.getElementById("homeDropdown").classList.toggle("show");
  }

  function toggleDropdown() {
    const dropdown = document.getElementById("profileDropdown");
    dropdown.classList.toggle("show");
  }
  window.addEventListener('click', function (event) {
    const dropdown = document.getElementById("homeDropdown");
    if (!event.target.closest('.home-container')) {
      dropdown.classList.remove('show');
    }
  });

  // Close dropdown when clicking outside
  window.onclick = function (event) {
    if (
      !event.target.matches(".profile-icon") &&
      !event.target.closest(".profile-icon")
    ) {
      const dropdown = document.getElementById("profileDropdown");
      if (dropdown.classList.contains("show")) {
        dropdown.classList.remove("show");
      }
    }
  };

document.getElementById('sendForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const form = e.target;
  const formData = new FormData(form);

  fetch(form.action, {
    method: 'POST',
    body: formData,
    credentials: 'same-origin'
  })
  .then(response => response.text())
  .then(html => {
    // Try to extract the recipient email from the form
    const toEmail = formData.get('to');
    document.getElementById('successEmail').textContent = toEmail;
    document.getElementById('successModal').style.display = 'block';
  })
  .catch(err => {
    alert('Failed to send email.');
  });
});

  function closeModal() {
    document.getElementById("successModal").style.display = "none";
  }
</script>
{% endblock %}